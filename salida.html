<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrar salida · Inventario</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root{ --card-bg: rgba(255,255,255,.12); --card-br: 18px; --blur: blur(18px); }
    *{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif }
    body{
      min-height:100vh; margin:0; color:#fff;
      background:
        radial-gradient(1200px 600px at 10% 10%, #9db6d4 0%, transparent 60%),
        radial-gradient(900px 500px at 90% 20%, #9db6d4 0%, transparent 60%),
        linear-gradient(135deg,#7e8a8f,#74777d 60%,#9db6d4);
      overflow-x:hidden;
    }
    .glass{ background:var(--card-bg); border:1px solid rgba(255,255,255,.15); border-radius:var(--card-br);
            backdrop-filter:var(--blur); box-shadow:0 10px 60px rgba(0,0,0,.25); }
    .brand{ width:58px;height:58px;border-radius:14px;overflow:hidden;display:grid;place-items:center;
            background:linear-gradient(135deg,#8d98a5,#657274) }
    .muted{ color:rgba(255,255,255,.85) }
    .nav-link{ color:#e7ecff; text-decoration:none; margin-right:12px }
    .nav-link.active,.nav-link:hover{ text-decoration:underline }
    .btn-grad{ background:linear-gradient(135deg,#2563eb,#1d4ed8); border:0; font-weight:700 }
    .btn-icon{ display:inline-flex; align-items:center; gap:.35rem }
    .form-control,.form-select{ background:rgba(255,255,255,.18); color:#fff; border:1px solid rgba(255,255,255,.25) }
    .form-control::placeholder{ color:#e8eeff }
    .form-control:focus,.form-select:focus{
      border-color:rgba(255,255,255,.6); box-shadow:0 0 0 .25rem rgba(99,102,241,.25);
      background:rgba(255,255,255,.22); color:#fff
    }
    .form-select, 
    .form-select option {
      color: #000 !important;   
      background-color: #fff;   
    }
  </style>
</head>
<body>

<!-- Top bar -->
<div class="container pt-3">
  <div class="d-flex align-items-center justify-content-between">
    <div class="d-flex align-items-center gap-3">
      <div class="brand">
        <img src="{{ url_for('static', filename='ovalle.png') }}" alt="Logo"
             style="width:58px;height:58px;object-fit:cover">
      </div>
      <div>
        <div class="fw-bold">Sistema de Inventario</div>
        <small class="muted">Bienvenido, {{ session.get('user','') }} · Rol: {{ session.get('rol','') }}</small>
      </div>
    </div>

    <div class="d-none d-md-block">
      <a class="nav-link {% if request.path.startswith('/inicio') %}active{% endif %}" href="{{ url_for('inicio') }}">Inicio</a>
      <a class="nav-link {% if request.path.startswith('/inventario') %}active{% endif %}" href="{{ url_for('inventario_list') }}">Inventario</a>
      <a class="nav-link active" href="{{ url_for('salida') }}">Salida</a>
      {% if session.get('rol') == 'Administrador' %}
        <a class="nav-link {% if request.path.startswith('/historico') %}active{% endif %}" href="{{ url_for('historico') }}">Histórico</a>
      {% endif %}
    </div>

    <div>
      <a class="btn btn-outline-light btn-sm" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right me-1"></i>Salir</a>
    </div>
  </div>
</div>

<div class="container py-4">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for c,m in messages %}
        <div class="alert alert-{{c}} glass">{{ m }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="glass p-4 mb-4">
    <h1 class="h4 mb-1">Registrar salida</h1>
    <small class="muted">Descuenta stock de un producto activo.</small>

    <form class="row g-3 mt-3" method="post">
      <!-- Producto -->
      <div class="col-md-7">
        <label class="form-label">Producto (activos)</label>
        <select class="form-select" name="idProducto" required>
          <option value="" disabled selected>Selecciona…</option>
          {% for p in productos %}
            <option value="{{ p.idProducto }}">{{ p.nombre }} — stock: {{ p.cantidad }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Cantidad -->
      <div class="col-md-3">
        <label class="form-label">Cantidad</label>
        <input type="number" name="cantidad" class="form-control" min="1" required>
      </div>

      <!-- Botón -->
      <div class="col-md-2 d-flex align-items-end">
        <button class="btn btn-grad btn-icon w-100">
          <i class="bi bi-box-arrow-up"></i><span>Registrar</span>
        </button>
      </div>
    </form>
  </div>

  <a class="btn btn-outline-light btn-sm" href="{{ url_for('inventario_list') }}">
    <i class="bi bi-arrow-left"></i> Volver al inventario
  </a>
</div>
<script>
  const form = document.querySelector('form');
  form?.addEventListener('submit', () => {
    const btn = form.querySelector('button[type="submit"], .btn-grad');
    if (btn) { btn.disabled = true; btn.innerText = 'Guardando...'; }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
